---
title: "MP4"
author: "Sam Ellinwood, Haley McAtee, Sam Schneider"
date: "12/14/2017"
output: 
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning = FALSE, message = FALSE}
#Load packages
library(mdsr)
library(tidyverse)
library(RMySQL)
```


```{r, warning = FALSE, message = FALSE}
#Create a table with movies with terrorist tags
db <- dbConnect_scidb(dbname = "imdb")
tbl_1 <- db %>%
  dbGetQuery("SELECT DISTINCT t1.id, t1.title, t1.production_year, t2.movie_id
FROM (SELECT DISTINCT id, title, production_year,kind_id FROM title AS t1
JOIN (SELECT DISTINCT movie_keyword.movie_id FROM movie_keyword JOIN imdb.keyword ON keyword.id = movie_keyword.keyword_id 
	WHERE keyword.id = 1149 OR keyword.id = 4232
	OR keyword.id = 4671 OR keyword.id = 4672 OR keyword.id = 4669) AS t2
ON t1.id = t2.movie_id")
```

```{r}
db2 <- dbConnect_scidb(dbname = "imdb")
tbl_5 <- db2 %>%
  dbGetQuery("
              SELECT * FROM imdb.movie_info
              where info = 'USA';")
```

```{r}
#Joining all movies made in the USA that also have terrorist tags

tbl_1 %>%
  inner_join(tbl_5, by = "movie_id")

```

```{r, warning = FALSE, message = FALSE}
#Create a table of all movies
tbl_2 <- db %>%
  dbGetQuery("SELECT DISTINCT movie_id, production_year
             FROM aka_title") %>%
  group_by(production_year) %>%
  summarize("total_num_movies" = n())
```

```{r, warning = FALSE, message = FALSE}
#Join the first two tables
tbl_3 <- tbl_1[!duplicated(tbl_1$movie_id), (colnames(tbl_1))] %>%
  left_join(tbl_2, by = "production_year")
```


```{r, warning = FALSE, message = FALSE}
#Summarize the final data table
tbl_3 %>%
  filter(production_year > 1936, production_year < 2016) %>%
  group_by(production_year) %>%
  summarize("num_terror_movies" = n(),
            "total_num_movies" = mean(total_num_movies),
            "num_terror_controlled" = num_terror_movies/total_num_movies)  %>%
  #Create our graphic
  ggplot(aes(x = production_year, y = num_terror_controlled)) + 
  geom_smooth() +
  geom_point() +
  scale_x_continuous(breaks=seq(1900,2017,20)) +
  ggtitle("Percentage of Movies Tagged as 'Terrorist' from 1936-2016") +
  labs(x="Year",y="Percentage of Movies") +
  scale_y_continuous(labels = scales::percent) +
  #Adding points referencing important dates/events
  annotate("segment", shape = 21, x = 2001, xend = 2001, y = .01004, yend = .00993, color = "red") +
  annotate("text", color = "black", label = "9/11 Attack", x = 2004, y = .006) +
  
  annotate("segment", shape = 21, x = 1995, xend = 1995, y = .01146, yend = .0041, color = "red") +
  annotate("text", color = "black", label = "OKC Bombing", x = 1993, y = .0038) +
  
  
  annotate("segment", shape = 21, x = 1970, xend = 1970, y = .00231, yend = .0068, color = "red") +
  annotate("text", color = "black", label = "Beginning of", x = 1970, y = .0088) +
  annotate("text", color = "black", label = "'Golden Age'", x = 1970, y = .008) +
  annotate("text", color = "black", label = "of Terrorism", x = 1970, y = .0072)
```


**The Fear of Terrorism May Be Too Much For Hollywood **

The impact of horrifying global terrorist attacks is manifesting itself in Hollywood. Although the subject matter of Hollywood movies has traditionally reflected the feelings of a nation, the fear of these horrendous attacks may hit too close to home. The movie industry may be able to provide insight into the vast societal impact of terrorism as a whole.  

A movie's potential to connect with its audience hinges on its ability to depict a meaningful subject matter that hits the audience close to home. Movie producers aim to create movies that reflect the feelings of the general public at a given time. This suggests that an event such as a terrorist attack that strikes fear into a nation would spur the creation of movies with similar subject matter, invoking a cathartic reaction. While this has traditionally been the case for smaller scale attacks in looking at the percentage of movies tagged as 'terrorist' in the IMDB database, there appears to have been a shift in the post 9/11 world. In the wake of the World Trade Center attack, the amount of movies related to terrorism as a share of total movies made has fallen by roughly 50%. This fall suggests that the scale and cultural impact of these attacks was so large that the cathartic value of movies related to terrorism is outweighed by the pain of reliving that fateful day in 2001. On a larger scale, this trend reflects the deep societal impact felt from the rise in global terror. 

